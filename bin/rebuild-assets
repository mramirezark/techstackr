#!/usr/bin/env ruby
require "fileutils"

APP_ROOT = File.expand_path("..", __dir__)

def system!(*args)
  system(*args, exception: true)
end

def puts_step(message)
  puts "â–¶ #{message}"
end

def puts_success(message)
  puts "âœ… #{message}"
end

FileUtils.chdir APP_ROOT do
  puts "ğŸ”„ Rebuilding Assets..."
  puts "=" * 30

  begin
    puts_step("Cleaning old assets...")
    system! "bin/rails assets:clobber"
    system! "bin/rails tailwindcss:clobber"
    puts_success("Assets cleaned")

    puts_step("Building Tailwind CSS...")
    system! "bin/rails tailwindcss:build"
    puts_success("Tailwind CSS built")

    puts_step("Precompiling assets...")
    system! "bin/rails assets:precompile"
    puts_success("Assets precompiled")

    puts "\nğŸ‰ Asset rebuild complete!"

  rescue => e
    puts "\nâŒ Asset rebuild failed: #{e.message}"
    exit 1
  end
end
