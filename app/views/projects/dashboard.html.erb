<% content_for :title, "AI Recommendations Dashboard - TechStackr" %>

<!-- Modal Container -->
<div id="modal-content"></div>

<!-- Dashboard Header -->
<div class="dashboard-header animate-fade-in">
  <div class="breadcrumb">Pages / AI Dashboard</div>
  <h1 class="page-title">ü§ñ AI Recommendations Dashboard</h1>
  <p class="text-blue-100 mt-2">View all your AI-generated tech stack recommendations and insights</p>
</div>

<% if @total_recommendations > 0 %>
  <!-- Statistics Cards -->
  <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6 animate-slide-up">
    <!-- Total Recommendations -->
    <div class="stats-card">
      <div class="stats-card-header">
        <div>
          <p class="stats-card-title">Total Recommendations</p>
          <p class="stats-card-value"><%= @total_recommendations %></p>
          <p class="stats-card-change stats-card-change-positive">+100% since last month</p>
        </div>
        <div class="stats-card-icon stats-card-icon-blue">
          <span class="text-xl">üìä</span>
        </div>
      </div>
    </div>

    <!-- Total Technologies -->
    <div class="stats-card">
      <div class="stats-card-header">
        <div>
          <p class="stats-card-title">Technologies</p>
          <p class="stats-card-value"><%= @total_technologies %></p>
          <p class="stats-card-change stats-card-change-positive">+25% since last month</p>
        </div>
        <div class="stats-card-icon stats-card-icon-purple">
          <span class="text-xl">üíª</span>
        </div>
      </div>
    </div>

    <!-- Total Team Members -->
    <div class="stats-card">
      <div class="stats-card-header">
        <div>
          <p class="stats-card-title">Team Members</p>
          <p class="stats-card-value"><%= @total_team_members %></p>
          <p class="stats-card-change stats-card-change-positive">+15% since last month</p>
        </div>
        <div class="stats-card-icon stats-card-icon-green">
          <span class="text-xl">üë•</span>
        </div>
      </div>
    </div>

    <!-- Industries Covered -->
    <div class="stats-card">
      <div class="stats-card-header">
        <div>
          <p class="stats-card-title">Industries</p>
          <p class="stats-card-value"><%= @industries.count %></p>
          <p class="stats-card-change stats-card-change-positive">+2 new this month</p>
        </div>
        <div class="stats-card-icon stats-card-icon-red">
          <span class="text-xl">üè¢</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Analytics Section -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
    <!-- Popular Technologies -->
    <div class="card animate-slide-up" style="animation-delay: 0.1s;">
      <h2 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
        <span class="text-xl">üî•</span>
        <span>Top Technologies</span>
      </h2>
      
      <% if @popular_technologies.any? %>
        <div class="space-y-2">
          <% @popular_technologies.first(5).each do |(name, category), count| %>
            <div class="bg-gray-50 rounded-lg p-3 hover:bg-gray-100 transition-colors">
              <div class="flex items-center justify-between">
                <div class="flex-1">
                  <h3 class="font-semibold text-gray-900 text-sm mb-1"><%= name %></h3>
                  <span class="badge badge-primary badge-xs"><%= category %></span>
                </div>
                <div class="flex items-center gap-1">
                  <span class="text-lg font-bold text-blue-600"><%= count %></span>
                  <span class="text-xs text-gray-500"><%= count == 1 ? 'x' : 'x' %></span>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-gray-500 text-center py-4 text-sm">No data yet</p>
      <% end %>
    </div>

    <!-- Popular Roles -->
    <div class="card animate-slide-up" style="animation-delay: 0.2s;">
      <h2 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
        <span class="text-xl">üëî</span>
        <span>Top Roles</span>
      </h2>
      
      <% if @popular_roles.any? %>
        <div class="space-y-2">
          <% @popular_roles.first(5).each do |role, count| %>
            <div class="bg-gray-50 rounded-lg p-3 hover:bg-gray-100 transition-colors">
              <div class="flex items-center justify-between">
                <div class="flex-1">
                  <h3 class="font-semibold text-gray-900 text-sm"><%= role %></h3>
                </div>
                <div class="flex items-center gap-1">
                  <span class="text-lg font-bold text-purple-600"><%= count %></span>
                  <span class="text-xs text-gray-500">people</span>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-gray-500 text-center py-4 text-sm">No data yet</p>
      <% end %>
    </div>
  </div>

  <!-- Industries Breakdown -->
  <% if @industries.any? %>
    <div class="card animate-slide-up mb-6" style="animation-delay: 0.3s;">
      <h2 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
        <span class="text-xl">üè≠</span>
        <span>Industries</span>
      </h2>
      
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
        <% @industries.each do |industry, count| %>
          <div class="bg-gray-50 rounded-lg p-3 text-center hover:bg-gray-100 transition-colors">
            <p class="text-sm font-semibold text-gray-900 mb-1"><%= industry %></p>
            <p class="text-lg font-bold text-green-600"><%= count %></p>
            <p class="text-xs text-gray-500"><%= count == 1 ? 'project' : 'projects' %></p>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- All Recommendations List -->
  <div class="card animate-slide-up" style="animation-delay: 0.4s;">
    <h2 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
      <span class="text-xl">üìö</span>
      <span>All Recommendations</span>
    </h2>

    <div class="space-y-3">
      <% @projects.each_with_index do |project, index| %>
        <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-all animate-fade-in border border-gray-200" style="animation-delay: <%= (index * 0.05) + 0.5 %>s;">
          <!-- Project Header -->
          <div class="flex items-start justify-between mb-3">
            <div class="flex-1">
              <h3 class="text-lg font-bold text-gray-900 mb-1"><%= project.title %></h3>
              <div class="flex flex-wrap gap-1 mb-2">
                <span class="badge badge-primary badge-sm"><%= project.industry %></span>
                <span class="badge badge-secondary badge-sm"><%= project.project_type.gsub('_', ' ').titleize %></span>
                <span class="badge badge-neutral badge-sm">üë• <%= project.estimated_team_size %></span>
                <span class="badge badge-info badge-sm">üìÖ <%= project.created_at.strftime("%b %d") %></span>
              </div>
              <p class="text-gray-600 text-xs line-clamp-2"><%= project.description %></p>
            </div>
            <button class="btn btn-primary btn-xs ml-3" 
                    data-action="showProjectDetails" 
                    data-project-id="<%= project.id %>">
              View ‚Üí
            </button>
          </div>

          <% if project.recommendation %>
            <!-- Recommendation Summary -->
            <div class="bg-gray-100 rounded-lg p-3 mb-3">
              <h4 class="text-xs font-semibold text-gray-600 uppercase tracking-wider mb-1">AI Summary</h4>
              <p class="text-gray-700 text-xs line-clamp-2"><%= truncate(project.recommendation.summary, length: 150) %></p>
            </div>

            <!-- Quick Stats -->
            <div class="grid grid-cols-4 gap-2">
              <!-- Technologies Count -->
              <div class="bg-white rounded-lg p-2 text-center border border-gray-200">
                <p class="text-lg font-bold text-blue-600"><%= project.recommendation.technologies.count %></p>
                <p class="text-xs text-gray-500">Tech</p>
              </div>

              <!-- Team Members Count -->
              <div class="bg-white rounded-lg p-2 text-center border border-gray-200">
                <p class="text-lg font-bold text-purple-600"><%= project.recommendation.team_members.sum(:count) %></p>
                <p class="text-xs text-gray-500">Team</p>
              </div>

              <!-- Technology Categories -->
              <div class="bg-white rounded-lg p-2 text-center border border-gray-200">
                <p class="text-lg font-bold text-green-600"><%= project.recommendation.technologies.pluck(:category).uniq.count %></p>
                <p class="text-xs text-gray-500">Categories</p>
              </div>

              <!-- Team Roles -->
              <div class="bg-white rounded-lg p-2 text-center border border-gray-200">
                <p class="text-lg font-bold text-orange-600"><%= project.recommendation.team_members.count %></p>
                <p class="text-xs text-gray-500">Roles</p>
              </div>
            </div>

            <!-- Technology Preview -->
            <% if project.recommendation.technologies.any? %>
              <div class="mt-3">
                <h4 class="text-xs font-semibold text-gray-600 uppercase tracking-wider mb-2">Tech Stack</h4>
                <div class="flex flex-wrap gap-1">
                  <% project.recommendation.technologies.first(6).each do |tech| %>
                    <span class="badge badge-sm bg-blue-100 text-blue-800 border border-blue-200">
                      <%= tech.name %>
                    </span>
                  <% end %>
                  <% if project.recommendation.technologies.count > 6 %>
                    <span class="badge badge-sm badge-neutral">
                      +<%= project.recommendation.technologies.count - 6 %>
                    </span>
                  <% end %>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

<% else %>
  <!-- Empty State -->
  <div class="card-empty animate-scale-in">
    <div class="max-w-md mx-auto">
      <div class="text-6xl mb-6">ü§ñ</div>
      <h2 class="text-2xl font-bold text-gray-900 mb-3">No AI Recommendations Yet</h2>
      <p class="text-gray-600 mb-8">Create a project and generate AI recommendations to see them here!</p>
      <%= link_to root_path, { class: "btn btn-primary btn-xl hover-lift" } do %>
        <span class="text-2xl">üìã</span>
        <span>Go to Projects</span>
      <% end %>
    </div>
  </div>
<% end %>

